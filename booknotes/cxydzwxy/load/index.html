
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A blog about technical things, such as book notes and simple topics.">
      
      
        <meta name="author" content="Little Bee">
      
      
        <link rel="canonical" href="https://littlebee1024.github.io/learning_book/booknotes/cxydzwxy/load/">
      
      
        <link rel="prev" href="../link/dynamic/">
      
      
        <link rel="next" href="../../debug_hacks/basic/">
      
      
      <link rel="icon" href="../../../home/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>装载 - Little Bee Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+Simplified+Chinese:300,300i,400,400i,700,700i%7CConsolas:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans Simplified Chinese";--md-code-font:"Consolas"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-G2RFHH3DL4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-G2RFHH3DL4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-G2RFHH3DL4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Little Bee Blog" class="md-header__button md-logo" aria-label="Little Bee Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.4 9C17 7.8 16.2 7 15 6.5V5h-1v1.4h-.4c-1.1 0-2 .4-2.8 1.2l-.4.4L9 7.5c-.3-.1-.6-.2-1-.2-.6 0-1.2.2-1.7.6-.6.4-.9.9-1.1 1.4-.2.7-.2 1.3 0 2 .3.7.6 1.2 1.1 1.5-.4 1.5-.1 2.8 1 3.9.8.8 1.7 1.2 2.8 1.2.5 0 .8 0 1.1-.1.6.8 1.4 1.3 2.4 1.3.3 0 .7 0 1-.1.6-.2 1-.6 1.4-1.1.4-.6.6-1.1.6-1.7 0-.4 0-.7-.1-1l-.5-1.6.6-.4c.8-.8 1.2-1.9 1.1-3.1H19V9zm-9.7 2.3c-.6-.3-.8-.7-.6-1.3q.3-.9 1.2-.6l3.2 1.2c-1.6.8-2.8 1-3.8.7m6.3 5.6c-.6.2-1 0-1.3-.6-.3-1-.1-2.2.7-3.8l1.2 3.1c.2.7 0 1.1-.6 1.3m1.2-5.3-.6-1.6v-.1l-.3-.3h-.1L12.6 9c.4-.3.8-.5 1.3-.5s1 .2 1.4.6.6.8.6 1.3c-.2.3-.4.8-.7 1.2"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Little Bee Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              装载
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/littlebee1024/learning_book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    littlebee1024/learning_book
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../concurrency/" class="md-tabs__link">
          
  
  笔记

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../topics/webassembly/" class="md-tabs__link">
          
  
  专题

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../essays/20250127/" class="md-tabs__link">
          
  
  随笔

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Little Bee Blog" class="md-nav__button md-logo" aria-label="Little Bee Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.4 9C17 7.8 16.2 7 15 6.5V5h-1v1.4h-.4c-1.1 0-2 .4-2.8 1.2l-.4.4L9 7.5c-.3-.1-.6-.2-1-.2-.6 0-1.2.2-1.7.6-.6.4-.9.9-1.1 1.4-.2.7-.2 1.3 0 2 .3.7.6 1.2 1.1 1.5-.4 1.5-.1 2.8 1 3.9.8.8 1.7 1.2 2.8 1.2.5 0 .8 0 1.1-.1.6.8 1.4 1.3 2.4 1.3.3 0 .7 0 1-.1.6-.2 1-.6 1.4-1.1.4-.6.6-1.1.6-1.7 0-.4 0-.7-.1-1l-.5-1.6.6-.4c.8-.8 1.2-1.9 1.1-3.1H19V9zm-9.7 2.3c-.6-.3-.8-.7-.6-1.3q.3-.9 1.2-.6l3.2 1.2c-1.6.8-2.8 1-3.8.7m6.3 5.6c-.6.2-1 0-1.3-.6-.3-1-.1-2.2.7-3.8l1.2 3.1c.2.7 0 1.1-.6 1.3m1.2-5.3-.6-1.6v-.1l-.3-.3h-.1L12.6 9c.4-.3.8-.5 1.3-.5s1 .2 1.4.6.6.8.6 1.3c-.2.3-.4.8-.7 1.2"/></svg>

    </a>
    Little Bee Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/littlebee1024/learning_book" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    littlebee1024/learning_book
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    笔记
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    程序员的自我修养
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            程序员的自我修养
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../concurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    并发
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    链接
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            链接
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../link/static/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    静态链接
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../link/dynamic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态链接
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    装载
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    装载
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      进程虚拟地址空间
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程虚拟地址空间">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      32位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64" class="md-nav__link">
    <span class="md-ellipsis">
      64位
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      装载的方式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="装载的方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      实例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      进程的建立
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      页错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      进程虚拟空间分布
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程虚拟空间分布">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elf" class="md-nav__link">
    <span class="md-ellipsis">
      ELF链接视图和执行视图
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      堆和栈
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elf_1" class="md-nav__link">
    <span class="md-ellipsis">
      内核装载ELF过程
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Debug Hacks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Debug Hacks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_hacks/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    调试前的必知必会
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_hacks/advance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高级调试技术
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_hacks/gdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug_hacks/dwarf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DWARF
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux高性能服务器编程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Linux高性能服务器编程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hplsp/tcp_ip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCP/IP协议
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hplsp/socket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    套接字基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hplsp/multi_io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IO复用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hplsp/adv_io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高级IO函数
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux设备驱动程序
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Linux设备驱动程序
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ldd/module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内核模块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ldd/cdev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符设备驱动
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ldd/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高级I/O操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ldd/mem_port/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    与硬件通信
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    深入理解计算机系统
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            深入理解计算机系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算机漫游
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    信息的表示和处理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/03/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    程序的机器表示
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/04/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    处理器体系结构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    优化程序性能
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/08/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    异常流控制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/09/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    虚拟内存
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../csapp/10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系统级I/O
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    机器学习
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            机器学习
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/linear_reg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性回归
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/naive_bayes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    朴素贝叶斯法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/decision_tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    决策树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/perceptron/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    感知机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/svm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    支持向量机
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    高效C/C++调试
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            高效C/C++调试
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cpp_debug/01/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    调试符号和调试器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cpp_debug/02/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    堆数据结构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cpp_debug/05/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    优化后的二进制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cpp_debug/10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内存调试工具
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    专题
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            专题
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/webassembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WebAssembly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/cmake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CMake
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vue3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Vue3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/vue/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vue3简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/vue/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    组件复用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/vue/demo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    样例模板
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/flex_bison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flex和Bison
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/tcl_tk_in_c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tcl/Tk in C
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    随笔
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            随笔
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../essays/20250127/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    来自AI的开篇
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      进程虚拟地址空间
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程虚拟地址空间">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      32位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64" class="md-nav__link">
    <span class="md-ellipsis">
      64位
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      装载的方式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="装载的方式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      实例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      进程的建立
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      页错误
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      进程虚拟空间分布
    </span>
  </a>
  
    <nav class="md-nav" aria-label="进程虚拟空间分布">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elf" class="md-nav__link">
    <span class="md-ellipsis">
      ELF链接视图和执行视图
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      堆和栈
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elf_1" class="md-nav__link">
    <span class="md-ellipsis">
      内核装载ELF过程
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  


<h1 id="_1">装载<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<blockquote>
<p><a href="https://1drv.ms/b/s!AkcJSyT7tq80cUuHb2eRcJkkBjM?e=YUwBqB">《程序员的自我修养--链接、装载与库》 - 俞甲子，石凡，潘爱民</a>，第六章的读书笔记，本文中的所有代码可在<a href="https://github.com/LittleBee1024/learning_book/tree/main/docs/booknotes/cxydzwxy/load/code">GitHub仓库</a>中找到</p>
</blockquote>
<h2 id="_2">进程虚拟地址空间<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="32">32位<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>32位系统的地址空间是4GB(2^32)，参见<a href="https://gabrieletolomei.wordpress.com/miscellanea/operating-systems/in-memory-layout/">文档</a>。其中，1GB是内核空间，3GB是用户空间：</p>
<ul>
<li>内核空间：0xC0000000 ~ 0xFFFFFFFF</li>
<li>用户空间：0x00000000 ~ 0xBFFFFFFF<ul>
<li><code>.text</code>段的加载地址是：0x08048000</li>
</ul>
</li>
</ul>
<p><img alt="vm_32bit" src="images/vm_32bit.png" /></p>
<h3 id="64">64位<a class="headerlink" href="#64" title="Permanent link">&para;</a></h3>
<p>64位系统的最大地址空间是16EB(2^64)，参见<a href="https://en.wikipedia.org/wiki/X86-64#Virtual_address_space_details">文档</a>。AMD架构规定了3种64位系统的虚拟地址空间规范，分别是：48-bit实现，57-bit实现和64-bit实现。</p>
<p><img alt="vm_64bit" src="images/vm_64bit.png" /></p>
<p>以48-bit实现为例，可用地址空间为两个128TB(2^47)范围(如下图)，分别是：</p>
<ul>
<li>内核空间：0xFFFF_8000_0000_0000 ~ 0xFFFF_FFFF_FFFF_FFFF</li>
<li>用户空间：0x0000_0000_0000_0000 ~ 0x0000_7FFF_FFFF_FFFF<ul>
<li>和32位系统一样，用户空间也包含了栈区、堆区、代码段、数据段等</li>
</ul>
</li>
</ul>
<p><img alt="vm_48bit" src="images/vm_48bit.png" /></p>
<p><a href="https://github.com/LittleBee1024/learning_book/tree/main/docs/booknotes/cxydzwxy/load/code/vm_addr">例子"vm_addr"</a>通过打印<code>__executable_start</code>变量的值，查看进程被加载的起始地址。默认情况下，gcc会利用ASLR，随机进程的加载地址。因此，需要加入链接选项<code>-static</code>或者手动指定链接脚本(<code>-T</code>)，以固定进程加载地址，便于观察。例子中的链接脚本<a href="code/vm_addr/main.lds">main.lds</a>和默认链接脚本<code>ld -verbose</code>一致，指定了加载地址<code>.</code>：
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="n">SECTIONS</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">PROVIDE</span><span class="w"> </span><span class="p">(</span><span class="n">__executable_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SEGMENT_START</span><span class="p">(</span><span class="s">&quot;text-segment&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x400000</span><span class="p">));</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SEGMENT_START</span><span class="p">(</span><span class="s">&quot;text-segment&quot;</span><span class="p">,</span><span class="w"> </span><span class="mh">0x400000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SIZEOF_HEADERS</span><span class="p">;</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
程序运行结果如下，其中：</p>
<ul>
<li>加载地址由<code>SEGMENT_START("text-segment", 0x400000) + SIZEOF_HEADERS</code>指定，运行结果是<code>0x400318</code></li>
<li><code>__executable_start</code>变量的值由<code>SEGMENT_START("text-segment", 0x400000)</code>指定，运行结果是<code>0x400000</code></li>
<li>进程运行时加载页的起始地址是<code>0x400000</code>，由链接时指定的加载地址<code>0x400318</code>决定</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="n">Executable</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="mh">0x400000</span>
<span class="n">Text</span><span class="w"> </span><span class="n">End</span><span class="w"> </span><span class="mh">0x401285</span><span class="w"> </span><span class="mh">0x401285</span><span class="w"> </span><span class="mh">0x401285</span>
<span class="n">Data</span><span class="w"> </span><span class="n">End</span><span class="w"> </span><span class="mh">0x404030</span><span class="w"> </span><span class="mh">0x404030</span>
<span class="n">Executable</span><span class="w"> </span><span class="n">End</span><span class="w"> </span><span class="mh">0x404038</span><span class="w"> </span><span class="mh">0x404038</span>

<span class="o">&gt;</span><span class="w"> </span><span class="n">objdump</span><span class="w"> </span><span class="o">-</span><span class="n">h</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="p">.</span><span class="o">/</span><span class="n">main</span><span class="o">:</span><span class="w">     </span><span class="n">file</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">elf64</span><span class="o">-</span><span class="n">x86</span><span class="mi">-64</span>
<span class="nl">Sections</span><span class="p">:</span>
<span class="n">Idx</span><span class="w"> </span><span class="n">Name</span><span class="w">          </span><span class="n">Size</span><span class="w">      </span><span class="n">VMA</span><span class="w">               </span><span class="n">LMA</span><span class="w">               </span><span class="n">File</span><span class="w"> </span><span class="n">off</span><span class="w">  </span><span class="n">Algn</span>
<span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="n">interp</span><span class="w">       </span><span class="mo">0000001</span><span class="n">c</span><span class="w">  </span><span class="mo">000000000040031</span><span class="mi">8</span><span class="w">  </span><span class="mo">000000000040031</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000031</span><span class="mi">8</span><span class="w">  </span><span class="mi">2</span><span class="o">**</span><span class="mi">0</span>
<span class="w">                  </span><span class="n">CONTENTS</span><span class="p">,</span><span class="w"> </span><span class="n">ALLOC</span><span class="p">,</span><span class="w"> </span><span class="n">LOAD</span><span class="p">,</span><span class="w"> </span><span class="n">READONLY</span><span class="p">,</span><span class="w"> </span><span class="n">DATA</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="n">note</span><span class="p">.</span><span class="n">gnu</span><span class="p">.</span><span class="n">property</span><span class="w"> </span><span class="mo">00000020</span><span class="w">  </span><span class="mo">000000000040033</span><span class="mi">8</span><span class="w">  </span><span class="mo">000000000040033</span><span class="mi">8</span><span class="w">  </span><span class="mo">0000033</span><span class="mi">8</span><span class="w">  </span><span class="mi">2</span><span class="o">**</span><span class="mi">3</span>
<span class="w">                  </span><span class="n">CONTENTS</span><span class="p">,</span><span class="w"> </span><span class="n">ALLOC</span><span class="p">,</span><span class="w"> </span><span class="n">LOAD</span><span class="p">,</span><span class="w"> </span><span class="n">READONLY</span><span class="p">,</span><span class="w"> </span><span class="n">DATA</span>

<span class="o">&gt;</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">debug</span>
<span class="n">Mapped</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">spaces</span><span class="o">:</span>
<span class="w">          </span><span class="n">Start</span><span class="w"> </span><span class="n">Addr</span><span class="w">           </span><span class="n">End</span><span class="w"> </span><span class="n">Addr</span><span class="w">       </span><span class="n">Size</span><span class="w">     </span><span class="n">Offset</span><span class="w"> </span><span class="n">objfile</span>
<span class="w">            </span><span class="mh">0x400000</span><span class="w">           </span><span class="mh">0x401000</span><span class="w">     </span><span class="mh">0x1000</span><span class="w">        </span><span class="mh">0x0</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="w">            </span><span class="mh">0x401000</span><span class="w">           </span><span class="mh">0x402000</span><span class="w">     </span><span class="mh">0x1000</span><span class="w">     </span><span class="mh">0x1000</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="w">            </span><span class="mh">0x402000</span><span class="w">           </span><span class="mh">0x403000</span><span class="w">     </span><span class="mh">0x1000</span><span class="w">     </span><span class="mh">0x2000</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="w">            </span><span class="mh">0x403000</span><span class="w">           </span><span class="mh">0x404000</span><span class="w">     </span><span class="mh">0x1000</span><span class="w">     </span><span class="mh">0x2000</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="w">            </span><span class="mh">0x404000</span><span class="w">           </span><span class="mh">0x405000</span><span class="w">     </span><span class="mh">0x1000</span><span class="w">     </span><span class="mh">0x3000</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">main</span>
<span class="w">      </span><span class="mh">0x7ffff7dbf000</span><span class="w">     </span><span class="mh">0x7ffff7de4000</span><span class="w">    </span><span class="mh">0x25000</span><span class="w">        </span><span class="mh">0x0</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libc</span><span class="mf">-2.31</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<h2 id="_3">装载的方式<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>内存和磁盘中的数据与指令按照“页(Page)”为单位划分成若干个页，所有装载和操作都以页为单位。通过<code>getconf PAGESIZE</code>命令可参看系统页的大小，一般系统都使用4096(0x1000)字节的页，如上节打印的进程虚拟内存，就是以<code>0x1000</code>大小的页为单位的。</p>
<h3 id="_4">实例<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>假设有一台32位机器，内存16KB，页大小为4096字节，因此共4页，地址分布如下：</p>
<table>
<thead>
<tr>
<th>页编号</th>
<th>地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>F0</td>
<td>0x0000_0000 ~ 0x0000_0FFF</td>
</tr>
<tr>
<td>F1</td>
<td>0x0000_1000 ~ 0x0000_1FFF</td>
</tr>
<tr>
<td>F2</td>
<td>0x0000_2000 ~ 0x0000_2FFF</td>
</tr>
<tr>
<td>F3</td>
<td>0x0000_3000 ~ 0x0000_3FFF</td>
</tr>
</tbody>
</table>
<p>现有一大小为32KB的程序需要装载。程序总共被分为8页(P0 ~ P7)，无法同时装入16KB的内存。因此，我们需要动态装载：</p>
<ul>
<li>如果程序刚开始执行时的入口地址在P0页，装载管理器发现程序的P0不在内存中，于是将内存F0分配给P0</li>
<li>运行一段时间以后，程序需要用到P5，于是装载器将P5转入F1；以此类推P3和P6被装入F2和F3，此时内存已满载</li>
<li>如果此时程序需要访问P4，装载器会根据特定算法，选择一个已经被分配掉的内存页来装载P4，例如按照先进先出的算法，用F0装载P4</li>
</ul>
<p><img alt="page_load" src="images/page_load.png" /></p>
<p>当程序需要P4的时候，它可能会被装入F0~F3中的任意一个。如果程序使用物理地址直接进行操作，那么每次页被装入时都需要进行重定位。因此需要进程需要使用虚拟地址而不是物理地址。硬件MMU提供了虚拟地址到物理地址的转换，将物理地址隐藏在虚拟地址之下。因此，对于程序来说，物理地址是透明的，不需要关心。</p>
<p>在硬件的地址转换和页映射机制的帮助下，程序可以不用考虑实际硬件大小的限制。例如上例中，虽然硬件只有16KB的内存，对于32KB的程序来说，拥有独立的32KB虚拟内存，可“同时”(分时复用)加载入全部的程序，并且地址连续。</p>
<p>下面，我们从操作系统的角度，来阐述一个可执行文件是如何被装载和执行的。</p>
<h3 id="_5">进程的建立<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>程序启动前，需要做以下三件事情：</p>
<ul>
<li>创建一个独立的虚拟地址空间<ul>
<li>创建虚拟地址和物理地址的映射关系</li>
<li>创建虚拟空间只是创建映射函数所需要的相关数据结构<ul>
<li>在Linux中，实际上只是分配了一个页目录(Page Directory)</li>
</ul>
</li>
</ul>
</li>
<li>读取可执行文件头，并且建立虚拟空间与可执行文件的映射关系<ul>
<li>创建虚拟空间与可执行文件的映射关系</li>
<li>当操作系统捕获到缺页错误时，需要知道程序当前所需要的页在可执行文件中的位置<ul>
<li>在Linux中，会在进程相应的数据结构中，设置段的VMA和段在ELF文件中的偏移的映射关系</li>
</ul>
</li>
</ul>
</li>
<li>将CPU的指令寄存器设置成可执行文件的入口地址，启动运行<ul>
<li>内核堆栈和用户堆栈的切换</li>
<li>CPU运行权限的切换</li>
</ul>
</li>
</ul>
<h3 id="_6">页错误<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>上面的步骤执行完以后，其实可执行文件的真正指令和数据都没有被装入到内存中。操作系统只是通过可执行文件头部的信息建立起可执行文件和进程虚拟内存之间的映射关系而已。</p>
<p>假设程序的入口地址时<code>0x08048000</code>，刚好是<code>.text</code>段的起始地址。当CPU开始执行这个地址的指令时，发现页面<code>0x08048000 ~ 0x08049000</code>是个空页面，于是触发一个<strong>页错误</strong>(Page Fault)。然后控制权被交给操作系统，来加载<code>.text</code>段到此页面，具体步骤如下：</p>
<ul>
<li>利用前面提到的第二步建立的虚拟空间和可执行文件的映射关系，找到空页面所在的VMA，并计算出相应的页面在可执行文件中的偏移</li>
<li>然后在物理内存中分配一个物理页面，加载可执行文件对应位置的内容到此物理页，并将进程中该虚拟页与分配的物理页之间建立映射关系</li>
<li>最后把控制权交还给进程，进程从刚才页错误的位置重新开始执行</li>
</ul>
<h2 id="_7">进程虚拟空间分布<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="elf">ELF链接视图和执行视图<a class="headerlink" href="#elf" title="Permanent link">&para;</a></h3>
<p>ELF文件中，段的权限往往只有为数不多的几种组合，基本上是三种：</p>
<ul>
<li>以代码段为代表的权限为可读可执行的段</li>
<li>以数据段和BSS段为代表的权限为可读可写的段</li>
<li>以只读数据段为代表的权限为只读的段</li>
</ul>
<p>为了有效利用内存，可将相同权限的段合并到一起当作一个段进行页映射。一个或多个属性类似的"Section"组成一个"Segment"，一个"Segment"在装载的时候只有一个对应的VMA，这样就可减少页面内部碎片，从而节省空间。</p>
<ul>
<li>从"Section"的角度来看ELF文件是<strong>链接视图</strong>(Linking View)<ul>
<li><code>readelf -S &lt;elf&gt;</code>可查看Section</li>
</ul>
</li>
<li>从"Segment"的角度来看是<strong>执行视图</strong>(Execution View)。<ul>
<li><code>readelf -l &lt;elf&gt;</code>可擦好看Segment</li>
</ul>
</li>
</ul>
<p><a href="https://github.com/LittleBee1024/learning_book/tree/main/docs/booknotes/cxydzwxy/load/code/segment">例子"segment"</a>展示了一个简单的可执行文件两种视图的关系：</p>
<ul>
<li>32个"Section"根据段的属性被分成了10个"Segment"</li>
<li>4个"LOAD"类型的"Segment"是需要被加载的，其他的诸如"NOTE"，"TLS", "GNU_STACK"都是在装载时起辅助作用的<ul>
<li>其中，第二个"LOAD"类型为可读可执行的部分，包括了代码段<code>.text</code>段</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err">&gt;</span><span class="w"> </span><span class="nf">readelf</span><span class="w"> </span><span class="p">-</span><span class="no">S</span><span class="w"> </span><span class="no">main</span>
<span class="nf">There</span><span class="w"> </span><span class="no">are</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="no">section</span><span class="w"> </span><span class="no">headers</span><span class="p">,</span><span class="w"> </span><span class="no">starting</span><span class="w"> </span><span class="no">at</span><span class="w"> </span><span class="no">offset</span><span class="w"> </span><span class="mi">0xd4588</span><span class="p">:</span>
<span class="nf">Section</span><span class="w"> </span><span class="no">Headers</span><span class="p">:</span>
<span class="w">  </span><span class="err">[</span><span class="nf">Nr</span><span class="p">]</span><span class="w"> </span><span class="no">Name</span><span class="w">              </span><span class="no">Type</span><span class="w">             </span><span class="no">Address</span><span class="w">           </span><span class="no">Offset</span>
<span class="w">       </span><span class="nf">Size</span><span class="w">              </span><span class="no">EntSize</span><span class="w">          </span><span class="no">Flags</span><span class="w">  </span><span class="no">Link</span><span class="w">  </span><span class="no">Info</span><span class="w">  </span><span class="no">Align</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">0]</span><span class="w">                   </span><span class="nf">NULL</span><span class="w">             </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="mi">00000000</span>
<span class="w">       </span><span class="err">0000000000000000</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">           </span><span class="err">0</span><span class="w">     </span><span class="err">0</span><span class="w">     </span><span class="err">0</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">1]</span><span class="w"> </span><span class="na">.note.gnu.propert</span><span class="w"> </span><span class="no">NOTE</span><span class="w">             </span><span class="mi">0000000000400270</span><span class="w">  </span><span class="mi">00000270</span>
<span class="w">       </span><span class="err">0000000000000020</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">   </span><span class="nf">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">2]</span><span class="w"> </span><span class="na">.note.gnu.build-i</span><span class="w"> </span><span class="no">NOTE</span><span class="w">             </span><span class="mi">0000000000400290</span><span class="w">  </span><span class="mi">00000290</span>
<span class="w">       </span><span class="err">0000000000000024</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">   </span><span class="nf">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">3]</span><span class="w"> </span><span class="na">.note.ABI-tag</span><span class="w">     </span><span class="no">NOTE</span><span class="w">             </span><span class="mi">00000000004002</span><span class="no">b4</span><span class="w">  </span><span class="mi">000002</span><span class="no">b4</span>
<span class="w">       </span><span class="err">0000000000000020</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">   </span><span class="nf">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">4]</span><span class="w"> </span><span class="na">.rela.plt</span><span class="w">         </span><span class="no">RELA</span><span class="w">             </span><span class="mi">00000000004002</span><span class="no">d8</span><span class="w">  </span><span class="mi">000002</span><span class="no">d8</span>
<span class="w">       </span><span class="err">0000000000000240</span><span class="w">  </span><span class="err">0000000000000018</span><span class="w">  </span><span class="nf">AI</span><span class="w">       </span><span class="mi">0</span><span class="w">    </span><span class="mi">20</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">5]</span><span class="w"> </span><span class="na">.init</span><span class="w">             </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">0000000000401000</span><span class="w">  </span><span class="mi">00001000</span>
<span class="w">       </span><span class="err">000000000000001</span><span class="nf">b</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">6]</span><span class="w"> </span><span class="na">.plt</span><span class="w">              </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">0000000000401020</span><span class="w">  </span><span class="mi">00001020</span>
<span class="w">       </span><span class="err">0000000000000180</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">  </span><span class="nf">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">16</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">7]</span><span class="w"> </span><span class="na">.text</span><span class="w">             </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004011</span><span class="no">a0</span><span class="w">  </span><span class="mi">000011</span><span class="no">a0</span>
<span class="w">       </span><span class="err">0000000000091</span><span class="nf">ec0</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">16</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">8]</span><span class="w"> </span><span class="nf">__libc_freeres_fn</span><span class="w"> </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">0000000000493060</span><span class="w">  </span><span class="mi">00093060</span>
<span class="w">       </span><span class="err">0000000000001</span><span class="nf">ca0</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">16</span>
<span class="w">  </span><span class="err">[</span><span class="w"> </span><span class="err">9]</span><span class="w"> </span><span class="na">.fini</span><span class="w">             </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">0000000000494</span><span class="no">d00</span><span class="w">  </span><span class="mi">00094</span><span class="no">d00</span>
<span class="w">       </span><span class="err">000000000000000</span><span class="nf">d</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">AX</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">4</span>
<span class="w">  </span><span class="err">[10]</span><span class="w"> </span><span class="na">.rodata</span><span class="w">           </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">0000000000495000</span><span class="w">  </span><span class="mi">00095000</span>
<span class="w">       </span><span class="err">000000000001</span><span class="nf">bd04</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">   </span><span class="no">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">32</span>
<span class="w">  </span><span class="err">[11]</span><span class="w"> </span><span class="na">.stapsdt.base</span><span class="w">     </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">b0d04</span><span class="w">  </span><span class="mi">000</span><span class="no">b0d04</span>
<span class="w">       </span><span class="err">0000000000000001</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">   </span><span class="nf">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="err">[12]</span><span class="w"> </span><span class="na">.eh_frame</span><span class="w">         </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">b0d08</span><span class="w">  </span><span class="mi">000</span><span class="no">b0d08</span>
<span class="w">       </span><span class="err">000000000000</span><span class="nf">a604</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">   </span><span class="no">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[13]</span><span class="w"> </span><span class="na">.gcc_except_table</span><span class="w"> </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">bb30c</span><span class="w">  </span><span class="mi">000</span><span class="no">bb30c</span>
<span class="w">       </span><span class="err">00000000000000</span><span class="nf">b1</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">   </span><span class="no">A</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">1</span>
<span class="w">  </span><span class="err">[14]</span><span class="w"> </span><span class="na">.tdata</span><span class="w">            </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">bd0c0</span><span class="w">  </span><span class="mi">000</span><span class="no">bc0c0</span>
<span class="w">       </span><span class="err">0000000000000020</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w"> </span><span class="nf">WAT</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[15]</span><span class="w"> </span><span class="na">.tbss</span><span class="w">             </span><span class="no">NOBITS</span><span class="w">           </span><span class="mi">00000000004</span><span class="no">bd0e0</span><span class="w">  </span><span class="mi">000</span><span class="no">bc0e0</span>
<span class="w">       </span><span class="err">0000000000000040</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w"> </span><span class="nf">WAT</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[16]</span><span class="w"> </span><span class="na">.init_array</span><span class="w">       </span><span class="no">INIT_ARRAY</span><span class="w">       </span><span class="mi">00000000004</span><span class="no">bd0e0</span><span class="w">  </span><span class="mi">000</span><span class="no">bc0e0</span>
<span class="w">       </span><span class="err">0000000000000010</span><span class="w">  </span><span class="err">0000000000000008</span><span class="w">  </span><span class="nf">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[17]</span><span class="w"> </span><span class="na">.fini_array</span><span class="w">       </span><span class="no">FINI_ARRAY</span><span class="w">       </span><span class="mi">00000000004</span><span class="no">bd0f0</span><span class="w">  </span><span class="mi">000</span><span class="no">bc0f0</span>
<span class="w">       </span><span class="err">0000000000000010</span><span class="w">  </span><span class="err">0000000000000008</span><span class="w">  </span><span class="nf">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[18]</span><span class="w"> </span><span class="na">.data.rel.ro</span><span class="w">      </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">bd100</span><span class="w">  </span><span class="mi">000</span><span class="no">bc100</span>
<span class="w">       </span><span class="err">0000000000002</span><span class="nf">df4</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">32</span>
<span class="w">  </span><span class="err">[19]</span><span class="w"> </span><span class="na">.got</span><span class="w">              </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">bfef8</span><span class="w">  </span><span class="mi">000</span><span class="no">beef8</span>
<span class="w">       </span><span class="err">00000000000000</span><span class="nf">f0</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[20]</span><span class="w"> </span><span class="na">.got.plt</span><span class="w">          </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">c0000</span><span class="w">  </span><span class="mi">000</span><span class="no">bf000</span>
<span class="w">       </span><span class="err">00000000000000</span><span class="nf">d8</span><span class="w">  </span><span class="mi">0000000000000008</span><span class="w">  </span><span class="no">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[21]</span><span class="w"> </span><span class="na">.data</span><span class="w">             </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">c00e0</span><span class="w">  </span><span class="mi">000</span><span class="no">bf0e0</span>
<span class="w">       </span><span class="err">0000000000001</span><span class="nf">a50</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">32</span>
<span class="w">  </span><span class="err">[22]</span><span class="w"> </span><span class="nf">__libc_subfreeres</span><span class="w"> </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">c1b30</span><span class="w">  </span><span class="mi">000</span><span class="no">c0b30</span>
<span class="w">       </span><span class="err">0000000000000048</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">  </span><span class="nf">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[23]</span><span class="w"> </span><span class="nf">__libc_IO_vtables</span><span class="w"> </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">c1b80</span><span class="w">  </span><span class="mi">000</span><span class="no">c0b80</span>
<span class="w">       </span><span class="err">00000000000006</span><span class="nf">a8</span><span class="w">  </span><span class="mi">0000000000000000</span><span class="w">  </span><span class="no">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">32</span>
<span class="w">  </span><span class="err">[24]</span><span class="w"> </span><span class="nf">__libc_atexit</span><span class="w">     </span><span class="no">PROGBITS</span><span class="w">         </span><span class="mi">00000000004</span><span class="no">c2228</span><span class="w">  </span><span class="mi">000</span><span class="no">c1228</span>
<span class="w">       </span><span class="err">0000000000000008</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">  </span><span class="nf">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="err">[25]</span><span class="w"> </span><span class="na">.bss</span><span class="w">              </span><span class="no">NOBITS</span><span class="w">           </span><span class="mi">00000000004</span><span class="no">c2240</span><span class="w">  </span><span class="mi">000</span><span class="no">c1230</span>
<span class="w">       </span><span class="err">0000000000001718</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">  </span><span class="nf">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">32</span>
<span class="w">  </span><span class="err">[26]</span><span class="w"> </span><span class="nf">__libc_freeres_pt</span><span class="w"> </span><span class="no">NOBITS</span><span class="w">           </span><span class="mi">00000000004</span><span class="no">c3958</span><span class="w">  </span><span class="mi">000</span><span class="no">c1230</span>
<span class="w">       </span><span class="err">0000000000000028</span><span class="w">  </span><span class="err">0000000000000000</span><span class="w">  </span><span class="nf">WA</span><span class="w">       </span><span class="mi">0</span><span class="w">     </span><span class="mi">0</span><span class="w">     </span><span class="mi">8</span>
<span class="w">  </span><span class="na">...</span>
<span class="nf">Key</span><span class="w"> </span><span class="no">to</span><span class="w"> </span><span class="no">Flags</span><span class="p">:</span>
<span class="w">  </span><span class="nf">W</span><span class="w"> </span><span class="p">(</span><span class="no">write</span><span class="p">),</span><span class="w"> </span><span class="no">A</span><span class="w"> </span><span class="p">(</span><span class="no">alloc</span><span class="p">),</span><span class="w"> </span><span class="no">X</span><span class="w"> </span><span class="p">(</span><span class="no">execute</span><span class="p">),</span><span class="w"> </span><span class="no">M</span><span class="w"> </span><span class="p">(</span><span class="no">merge</span><span class="p">),</span><span class="w"> </span><span class="no">S</span><span class="w"> </span><span class="p">(</span><span class="no">strings</span><span class="p">),</span><span class="w"> </span><span class="no">I</span><span class="w"> </span><span class="p">(</span><span class="no">info</span><span class="p">),</span>
<span class="w">  </span><span class="nf">L</span><span class="w"> </span><span class="p">(</span><span class="no">link</span><span class="w"> </span><span class="no">order</span><span class="p">),</span><span class="w"> </span><span class="no">O</span><span class="w"> </span><span class="p">(</span><span class="no">extra</span><span class="w"> </span><span class="no">OS</span><span class="w"> </span><span class="no">processing</span><span class="w"> </span><span class="no">required</span><span class="p">),</span><span class="w"> </span><span class="no">G</span><span class="w"> </span><span class="p">(</span><span class="no">group</span><span class="p">),</span><span class="w"> </span><span class="no">T</span><span class="w"> </span><span class="p">(</span><span class="no">TLS</span><span class="p">),</span>
<span class="w">  </span><span class="nf">C</span><span class="w"> </span><span class="p">(</span><span class="no">compressed</span><span class="p">),</span><span class="w"> </span><span class="no">x</span><span class="w"> </span><span class="p">(</span><span class="no">unknown</span><span class="p">),</span><span class="w"> </span><span class="no">o</span><span class="w"> </span><span class="p">(</span><span class="no">OS</span><span class="w"> </span><span class="no">specific</span><span class="p">),</span><span class="w"> </span><span class="no">E</span><span class="w"> </span><span class="p">(</span><span class="no">exclude</span><span class="p">),</span>
<span class="w">  </span><span class="nf">l</span><span class="w"> </span><span class="p">(</span><span class="no">large</span><span class="p">),</span><span class="w"> </span><span class="no">p</span><span class="w"> </span><span class="p">(</span><span class="no">processor</span><span class="w"> </span><span class="no">specific</span><span class="p">)</span>

<span class="err">&gt;</span><span class="w"> </span><span class="nf">readelf</span><span class="w"> </span><span class="p">-</span><span class="no">l</span><span class="w"> </span><span class="no">main</span>
<span class="nf">There</span><span class="w"> </span><span class="no">are</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="no">program</span><span class="w"> </span><span class="no">headers</span><span class="p">,</span><span class="w"> </span><span class="no">starting</span><span class="w"> </span><span class="no">at</span><span class="w"> </span><span class="no">offset</span><span class="w"> </span><span class="mi">64</span>
<span class="nf">Program</span><span class="w"> </span><span class="no">Headers</span><span class="p">:</span>
<span class="w">  </span><span class="nf">Type</span><span class="w">           </span><span class="no">Offset</span><span class="w">             </span><span class="no">VirtAddr</span><span class="w">           </span><span class="no">PhysAddr</span>
<span class="w">                 </span><span class="nf">FileSiz</span><span class="w">            </span><span class="no">MemSiz</span><span class="w">              </span><span class="no">Flags</span><span class="w">  </span><span class="no">Align</span>
<span class="w">  </span><span class="nf">LOAD</span><span class="w">           </span><span class="mi">0x0000000000000000</span><span class="w"> </span><span class="mi">0x0000000000400000</span><span class="w"> </span><span class="mi">0x0000000000400000</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000000518</span><span class="w"> </span><span class="mi">0x0000000000000518</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x1000</span>
<span class="w">  </span><span class="nf">LOAD</span><span class="w">           </span><span class="mi">0x0000000000001000</span><span class="w"> </span><span class="mi">0x0000000000401000</span><span class="w"> </span><span class="mi">0x0000000000401000</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000093d0d</span><span class="w"> </span><span class="mi">0x0000000000093d0d</span><span class="w">  </span><span class="no">R</span><span class="w"> </span><span class="no">E</span><span class="w">    </span><span class="mi">0x1000</span>
<span class="w">  </span><span class="nf">LOAD</span><span class="w">           </span><span class="mi">0x0000000000095000</span><span class="w"> </span><span class="mi">0x0000000000495000</span><span class="w"> </span><span class="mi">0x0000000000495000</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x00000000000263bd</span><span class="w"> </span><span class="mi">0x00000000000263bd</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x1000</span>
<span class="w">  </span><span class="nf">LOAD</span><span class="w">           </span><span class="mi">0x00000000000bc0c0</span><span class="w"> </span><span class="mi">0x00000000004bd0c0</span><span class="w"> </span><span class="mi">0x00000000004bd0c0</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000005170</span><span class="w"> </span><span class="mi">0x00000000000068c0</span><span class="w">  </span><span class="no">RW</span><span class="w">     </span><span class="mi">0x1000</span>
<span class="w">  </span><span class="nf">NOTE</span><span class="w">           </span><span class="mi">0x0000000000000270</span><span class="w"> </span><span class="mi">0x0000000000400270</span><span class="w"> </span><span class="mi">0x0000000000400270</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000000020</span><span class="w"> </span><span class="mi">0x0000000000000020</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x8</span>
<span class="w">  </span><span class="nf">NOTE</span><span class="w">           </span><span class="mi">0x0000000000000290</span><span class="w"> </span><span class="mi">0x0000000000400290</span><span class="w"> </span><span class="mi">0x0000000000400290</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000000044</span><span class="w"> </span><span class="mi">0x0000000000000044</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x4</span>
<span class="w">  </span><span class="nf">TLS</span><span class="w">            </span><span class="mi">0x00000000000bc0c0</span><span class="w"> </span><span class="mi">0x00000000004bd0c0</span><span class="w"> </span><span class="mi">0x00000000004bd0c0</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000000020</span><span class="w"> </span><span class="mi">0x0000000000000060</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x8</span>
<span class="w">  </span><span class="nf">GNU_PROPERTY</span><span class="w">   </span><span class="mi">0x0000000000000270</span><span class="w"> </span><span class="mi">0x0000000000400270</span><span class="w"> </span><span class="mi">0x0000000000400270</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000000020</span><span class="w"> </span><span class="mi">0x0000000000000020</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x8</span>
<span class="w">  </span><span class="nf">GNU_STACK</span><span class="w">      </span><span class="mi">0x0000000000000000</span><span class="w"> </span><span class="mi">0x0000000000000000</span><span class="w"> </span><span class="mi">0x0000000000000000</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000000000</span><span class="w"> </span><span class="mi">0x0000000000000000</span><span class="w">  </span><span class="no">RW</span><span class="w">     </span><span class="mi">0x10</span>
<span class="w">  </span><span class="nf">GNU_RELRO</span><span class="w">      </span><span class="mi">0x00000000000bc0c0</span><span class="w"> </span><span class="mi">0x00000000004bd0c0</span><span class="w"> </span><span class="mi">0x00000000004bd0c0</span>
<span class="w">                 </span><span class="err">0</span><span class="nf">x0000000000002f40</span><span class="w"> </span><span class="mi">0x0000000000002f40</span><span class="w">  </span><span class="no">R</span><span class="w">      </span><span class="mi">0x1</span>
<span class="w"> </span><span class="nf">Section</span><span class="w"> </span><span class="no">to</span><span class="w"> </span><span class="no">Segment</span><span class="w"> </span><span class="no">mapping</span><span class="p">:</span>
<span class="w">  </span><span class="nf">Segment</span><span class="w"> </span><span class="no">Sections...</span>
<span class="w">   </span><span class="err">00</span><span class="w">     </span><span class="na">.note.gnu.property</span><span class="w"> </span><span class="no">.note.gnu.build-id</span><span class="w"> </span><span class="no">.note.ABI-tag</span><span class="w"> </span><span class="no">.rela.plt</span><span class="w"> </span>
<span class="w">   </span><span class="mi">01</span><span class="w">     </span><span class="no">.init</span><span class="w"> </span><span class="no">.plt</span><span class="w"> </span><span class="no">.text</span><span class="w"> </span><span class="no">__libc_freeres_fn</span><span class="w"> </span><span class="no">.fini</span><span class="w"> </span>
<span class="w">   </span><span class="mi">02</span><span class="w">     </span><span class="no">.rodata</span><span class="w"> </span><span class="no">.stapsdt.base</span><span class="w"> </span><span class="no">.eh_frame</span><span class="w"> </span><span class="no">.gcc_except_table</span><span class="w"> </span>
<span class="w">   </span><span class="mi">03</span><span class="w">     </span><span class="no">.tdata</span><span class="w"> </span><span class="no">.init_array</span><span class="w"> </span><span class="no">.fini_array</span><span class="w"> </span><span class="no">.data.rel.ro</span><span class="w"> </span><span class="no">.got</span><span class="w"> </span><span class="no">.got.plt</span><span class="w"> </span><span class="no">.data</span><span class="w"> </span><span class="no">__libc_subfreeres</span><span class="w"> </span><span class="no">__libc_IO_vtables</span><span class="w"> </span><span class="no">__libc_atexit</span><span class="w"> </span><span class="no">.bss</span><span class="w"> </span><span class="no">__libc_freeres_ptrs</span><span class="w"> </span>
<span class="w">   </span><span class="mi">04</span><span class="w">     </span><span class="no">.note.gnu.property</span><span class="w"> </span>
<span class="w">   </span><span class="mi">05</span><span class="w">     </span><span class="no">.note.gnu.build-id</span><span class="w"> </span><span class="no">.note.ABI-tag</span><span class="w"> </span>
<span class="w">   </span><span class="mi">06</span><span class="w">     </span><span class="no">.tdata</span><span class="w"> </span><span class="no">.tbss</span><span class="w"> </span>
<span class="w">   </span><span class="mi">07</span><span class="w">     </span><span class="no">.note.gnu.property</span><span class="w"> </span>
<span class="w">   </span><span class="mi">08</span><span class="w">     </span>
<span class="w">   </span><span class="mi">09</span><span class="w">     </span><span class="no">.tdata</span><span class="w"> </span><span class="no">.init_array</span><span class="w"> </span><span class="no">.fini_array</span><span class="w"> </span><span class="no">.data.rel.ro</span><span class="w"> </span><span class="no">.got</span><span class="w"> </span>
</code></pre></div>
<p>由于只有可执行文件需要加载，因此只有可执行文件有程序头表<code>Program Headers</code>，目标文件中没有。根据程序头表中的"VirtAddr"，"MemSiz"以及系统的页大小，就可用推断出各段运行时在虚拟内存中的位置。</p>
<h3 id="_8">堆和栈<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>操作系统通过使用VMA来堆进程的地址空间进行管理。操作系统给进程空间划分出一个个VMA来管理进程的虚拟空间。基本原则是将相同权限属性的、有相同映像文件的映射成一个VMA。一个进程基本上可用分为如下几种VMA区域：</p>
<ul>
<li>代码VMA，权限只读、可执行；有映像文件</li>
<li>数据VMA，权限可读写、可执行；有映像文件</li>
<li>堆VMA，权限可读写、可执行；无映像文件，匿名，可向上扩展</li>
<li>栈VMA，权限可读写、不可执行；无映像文件，匿名，可向下扩展</li>
</ul>
<p>在Linux下，我们可通过<code>cat /proc/&lt;pid&gt;/maps</code>来查看进程的虚拟空间分布：</p>
<div class="highlight"><pre><span></span><code><span class="err">&gt;</span><span class="w"> </span><span class="nf">cat</span><span class="w"> </span><span class="err">/</span><span class="no">proc</span><span class="err">/&lt;</span><span class="no">pid</span><span class="err">&gt;/</span><span class="no">maps</span>
<span class="err">00400000-00401000</span><span class="w"> </span><span class="nf">r--p</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="mi">4589838</span><span class="w">                            </span><span class="p">.</span><span class="err">/</span><span class="no">main</span>
<span class="err">00401000-00495000</span><span class="w"> </span><span class="nf">r-xp</span><span class="w"> </span><span class="mi">00001000</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="mi">4589838</span><span class="w">                            </span><span class="p">.</span><span class="err">/</span><span class="no">main</span>
<span class="err">00495000-004</span><span class="nf">bc000</span><span class="w"> </span><span class="no">r--p</span><span class="w"> </span><span class="mi">00095000</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="mi">4589838</span><span class="w">                            </span><span class="p">.</span><span class="err">/</span><span class="no">main</span>
<span class="err">004</span><span class="nf">bd000-004c0000</span><span class="w"> </span><span class="no">r--p</span><span class="w"> </span><span class="mi">000</span><span class="no">bc000</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="mi">4589838</span><span class="w">                            </span><span class="p">.</span><span class="err">/</span><span class="no">main</span>
<span class="err">004</span><span class="nf">c0000-004c3000</span><span class="w"> </span><span class="no">rw-p</span><span class="w"> </span><span class="mi">000</span><span class="no">bf000</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">05</span><span class="w"> </span><span class="mi">4589838</span><span class="w">                            </span><span class="p">.</span><span class="err">/</span><span class="no">main</span>
<span class="err">004</span><span class="nf">c3000-004c4000</span><span class="w"> </span><span class="no">rw-p</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="mi">014</span><span class="no">e2000-01505000</span><span class="w"> </span><span class="no">rw-p</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w">                                  </span><span class="p">[</span><span class="no">heap</span><span class="p">]</span>
<span class="err">7</span><span class="nf">ffda9035000-7ffda9056000</span><span class="w"> </span><span class="no">rw-p</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w">                          </span><span class="p">[</span><span class="no">stack</span><span class="p">]</span>
<span class="err">7</span><span class="nf">ffda912d000-7ffda9131000</span><span class="w"> </span><span class="no">r--p</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w">                          </span><span class="p">[</span><span class="no">vvar</span><span class="p">]</span>
<span class="err">7</span><span class="nf">ffda9131000-7ffda9133000</span><span class="w"> </span><span class="no">r-xp</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w">                          </span><span class="p">[</span><span class="no">vdso</span><span class="p">]</span>
<span class="nf">ffffffffff600000-ffffffffff601000</span><span class="w"> </span><span class="p">--</span><span class="no">xp</span><span class="w"> </span><span class="mi">00000000</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="mi">0</span><span class="w">                  </span><span class="p">[</span><span class="no">vsyscall</span><span class="p">]</span>

<span class="err">&gt;</span><span class="w"> </span><span class="nf">ls</span><span class="w"> </span><span class="p">-</span><span class="no">i</span><span class="w"> </span><span class="p">.</span><span class="err">/</span><span class="no">main</span>
<span class="err">4589838</span><span class="w"> </span><span class="err">./</span><span class="nf">main</span>
</code></pre></div>
<p>除了前面几个VMA映射到了可执行文件<code>main</code>外（可执行文件的inode是4589838），其他的VMA的文件节点都是0，表示匿名虚拟内存区域(Anonymous Virtual Memory Area)。其中有两个区域分别是堆(Heap)和栈(Stack)，他们的大小分别是140KB和132KB。并且他们的大小随着程序的运行，会动态变换。<a href="https://github.com/LittleBee1024/learning_book/tree/main/docs/booknotes/cxydzwxy/load/code/max_malloc">例子"max_malloc"</a>可以打印当前系统<code>malloc</code>可以申请的最大堆数量。</p>
<p>上面映射到可执行文件的VMA，到<code>0x004c3000</code>就结束了，小于"Segment"中LOAD类型的最大值<code>0x004C3980</code>。这是因为操作系统对<code>.bss</code>段和<code>__libc_freeres_ptrs</code>段做了特殊处理，他们被直接映射到了堆中。</p>
<h2 id="elf_1">内核装载ELF过程<a class="headerlink" href="#elf_1" title="Permanent link">&para;</a></h2>
<p>Linux通过系统调用<code>execve()</code>进行ELF的装载过程，系统调用<code>execve()</code>的使用方法可参考<a href="https://github.com/LittleBee1024/learning_book/tree/main/docs/booknotes/cxydzwxy/load/code/minibash">例子"minibash"</a>，这里不再细述。</p>
<p>在内核中，系统调用<code>execve()</code>会先检查文件头，确定文件类型后，调用相应的装载函数。如，<code>load_elf_binary()</code>用于导入ELF文件，它的主要步骤是：</p>
<ul>
<li>检查ELF文件的有效性，比如魔数、程序头表中的段(Segment)的数量</li>
<li>寻找动态链接的<code>.interp</code>段，设置动态链接器路径</li>
<li>根据ELF可执行文件的程序头表的描述，堆ELF文件进行映射，比如代码、数据、只读数据等</li>
<li>初始化ELF进程环境</li>
<li>将<code>execve()</code>系统调用的返回地址修改成ELF可执行文件的入口点<ul>
<li>静态链接的ELF可执行文件，入口是ELF文件的文件头中的<code>e_entry</code>所指的地址</li>
<li>动态链接的ELF可执行文件，入口是动态链接器</li>
</ul>
</li>
</ul>









  




                

  <!-- Giscus https://giscus.app/ -->
  <script src="https://giscus.app/client.js"
    data-repo="LittleBee1024/learning_book"
    data-repo-id="R_kgDOGR3spQ"
    data-category="Q&A"
    data-category-id="DIC_kwDOGR3spc4B_q-C"
    data-mapping="title"
    data-strict="1"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="light"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async>
  </script>

  <!-- Reload on palette change -->
  <script>
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object")
      if (palette.color.scheme === "slate") {
        var giscus = document.querySelector("script[src*=giscus]")
        giscus.setAttribute("data-theme", "dark") 
      }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2022 Little Bee
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/littlebee1024" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/r/littlebee1024" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:littlebee1024@outlook.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>